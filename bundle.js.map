{"version":3,"file":"bundle.js","sources":["LocateControl.js","X2JS.js","config.js","main.js","rappid.js","utils.js","models/RoutesCollection.js","models/Shape.js","models/Stop.js","models/StopCollection.js","models/Trip.js","models/TripCollection.js","models/Vehicles.js"],"names":[],"mappings":"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","sourcesContent":["var leaflet = require('leaflet');\nvar when = require('when');\n\nvar LocateControl = leaflet.Control.extend({\n    userLatLng: [0, 0],\n    innerMarker: null,\n    outerMarker: null,\n    map: null,\n    options: {\n        icon: 'icon-location',\n        position: 'topleft',\n        zoomLevel: 16,\n        pollInterval: 30 * 1000\n    },\n    onAdd: function (map) {\n        this.container = leaflet.DomUtil.create('div', 'locate-control leaflet-bar leaflet-control');\n        this.map = map; // i wonder if this will cause memory leak\n\n        var link = leaflet.DomUtil .create('a', 'leaflet-bar-part leaflet-bar-part-single ' + this.options.icon, this.container);\n\n        leaflet.DomEvent\n            .on(link, 'click', leaflet.DomEvent.stopPropagation)\n            .on(link, 'click', leaflet.DomEvent.preventDefault)\n            .on(link, 'click', this.zoomToLocation.bind(this))\n            .on(link, 'dblclick', leaflet.DomEvent.stopPropagation);\n\n        this.locate();\n\n        return this.container;\n    },\n    zoomToLocation: function(map) {\n        this.map.setView(this.userLatLng, this.options.zoomLevel);\n    },\n    locate: function() {\n        this.container.classList.add('loading');\n\n        this.map.locate({\n            maximumAge: 1000,\n            enableHighAccuracy: true,\n            watch: true\n        });\n\n        this.map.on('locationfound', function(e) {\n            this.userLatLng = e.latlng;\n            this.updateMarkers();\n            this.container.classList.remove('loading');\n         }.bind(this));\n\n        this.map.on('locationerror', function(e) {\n            this.userLatLng = {lat: 30.268066, lng: -97.743189}; //Default location if we couldn't get yours.\n            this.updateMarkers();\n            this.container.classList.remove('loading');\n            console.error('Unable to find location: ', e.message);\n        }.bind(this));\n    },\n    updateMarkers: function() {\n        if (!this.innerMarker || !this.outerMarker) {\n            this.createMarkers(this.map);\n        }\n\n        this.innerMarker.setLatLng(this.userLatLng);\n        this.outerMarker.setLatLng(this.userLatLng);\n    },\n    createMarkers: function() {\n        this.innerMarker = leaflet.circleMarker(this.userLatLng,{\n            weight: 0,\n            fillColor: 'rgb(16,94,251)',\n            fill: true,\n            fillOpacity: 1,\n            radius: 5\n        });\n        this.outerMarker = leaflet.circleMarker(this.userLatLng, {\n            color: 'rgb(20,130,210)',\n            opacity: 1,\n            weight: 2,\n            fillColor: 'rgb(108,196,253)',\n            fill: true,\n            fillOpacity: 0.4,\n            radius: 15\n        });\n        this.outerMarker.addTo(this.map);\n        this.outerMarker.bindPopup('Current Location');\n        this.innerMarker.addTo(this.map);\n    }\n});\n\nmodule.exports = LocateControl;\n","/*\n Copyright 2011-2013 Abdulla Abdurakhmanov\n Original sources are available at https://code.google.com/p/x2js/\n\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n */\n\n/*\n I can't figure out how to get the bower version to work with almond,\n since it isn't doesn't do any of this AMD stuff. So, here it goes.\n */\n\nfunction X2JS(config) {\n    'use strict';\n\n    var VERSION = \"1.1.5\";\n\n    config = config || {};\n    initConfigDefaults();\n    initRequiredPolyfills();\n\n    function initConfigDefaults() {\n        if(config.escapeMode === undefined) {\n            config.escapeMode = true;\n        }\n        config.attributePrefix = config.attributePrefix || \"_\";\n        config.arrayAccessForm = config.arrayAccessForm || \"none\";\n        config.emptyNodeForm = config.emptyNodeForm || \"text\";\n        if(config.enableToStringFunc === undefined) {\n            config.enableToStringFunc = true;\n        }\n        config.arrayAccessFormPaths = config.arrayAccessFormPaths || [];\n        if(config.skipEmptyTextNodesForObj === undefined) {\n            config.skipEmptyTextNodesForObj = true;\n        }\n        if(config.stripWhitespaces === undefined) {\n            config.stripWhitespaces = true;\n        }\n        config.datetimeAccessFormPaths = config.datetimeAccessFormPaths || [];\n    }\n\n    var DOMNodeTypes = {\n        ELEMENT_NODE       : 1,\n        TEXT_NODE          : 3,\n        CDATA_SECTION_NODE : 4,\n        COMMENT_NODE       : 8,\n        DOCUMENT_NODE      : 9\n    };\n\n    function initRequiredPolyfills() {\n        function pad(number) {\n          var r = String(number);\n          if ( r.length === 1 ) {\n            r = '0' + r;\n          }\n          return r;\n        }\n        // Hello IE8-\n        if(typeof String.prototype.trim !== 'function') {\n            String.prototype.trim = function() {\n                return this.replace(/^\\s+|^\\n+|(\\s|\\n)+$/g, '');\n            }\n        }\n        if(typeof Date.prototype.toISOString !== 'function') {\n            // Implementation from http://stackoverflow.com/questions/2573521/how-do-i-output-an-iso-8601-formatted-string-in-javascript\n            Date.prototype.toISOString = function() {\n              return this.getUTCFullYear()\n                + '-' + pad( this.getUTCMonth() + 1 )\n                + '-' + pad( this.getUTCDate() )\n                + 'T' + pad( this.getUTCHours() )\n                + ':' + pad( this.getUTCMinutes() )\n                + ':' + pad( this.getUTCSeconds() )\n                + '.' + String( (this.getUTCMilliseconds()/1000).toFixed(3) ).slice( 2, 5 )\n                + 'Z';\n            };\n        }\n    }\n\n    function getNodeLocalName( node ) {\n        var nodeLocalName = node.localName;\n        if(nodeLocalName == null) // Yeah, this is IE!!\n            nodeLocalName = node.baseName;\n        if(nodeLocalName == null || nodeLocalName==\"\") // ==\"\" is IE too\n            nodeLocalName = node.nodeName;\n        return nodeLocalName;\n    }\n\n    function getNodePrefix(node) {\n        return node.prefix;\n    }\n\n    function escapeXmlChars(str) {\n        if(typeof(str) == \"string\")\n            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;').replace(/'/g, '&#x27;').replace(/\\//g, '&#x2F;');\n        else\n            return str;\n    }\n\n    function unescapeXmlChars(str) {\n        return str.replace(/&amp;/g, '&').replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '\"').replace(/&#x27;/g, \"'\").replace(/&#x2F;/g, '\\/');\n    }\n\n    function toArrayAccessForm(obj, childName, path) {\n        switch(config.arrayAccessForm) {\n        case \"property\":\n            if(!(obj[childName] instanceof Array))\n                obj[childName+\"_asArray\"] = [obj[childName]];\n            else\n                obj[childName+\"_asArray\"] = obj[childName];\n            break;\n        /*case \"none\":\n            break;*/\n        }\n\n        if(!(obj[childName] instanceof Array) && config.arrayAccessFormPaths.length > 0) {\n            var idx = 0;\n            for(; idx < config.arrayAccessFormPaths.length; idx++) {\n                var arrayPath = config.arrayAccessFormPaths[idx];\n                if( typeof arrayPath === \"string\" ) {\n                    if(arrayPath == path)\n                        break;\n                }\n                else\n                if( arrayPath instanceof RegExp) {\n                    if(arrayPath.test(path))\n                        break;\n                }\n                else\n                if( typeof arrayPath === \"function\") {\n                    if(arrayPath(obj, childName, path))\n                        break;\n                }\n            }\n            if(idx!=config.arrayAccessFormPaths.length) {\n                obj[childName] = [obj[childName]];\n            }\n        }\n    }\n\n    function fromXmlDateTime(prop) {\n        // Implementation based up on http://stackoverflow.com/questions/8178598/xml-datetime-to-javascript-date-object\n        // Improved to support full spec and optional parts\n        var bits = prop.split(/[-T:+Z]/g);\n\n        var d = new Date(bits[0], bits[1]-1, bits[2]);\n        var secondBits = bits[5].split(\"\\.\");\n        d.setHours(bits[3], bits[4], secondBits[0]);\n        if(secondBits.length>1)\n            d.setMilliseconds(secondBits[1]);\n\n        // Get supplied time zone offset in minutes\n        if(bits[6] && bits[7]) {\n            var offsetMinutes = bits[6] * 60 + Number(bits[7]);\n            var sign = /\\d\\d-\\d\\d:\\d\\d$/.test(prop)? '-' : '+';\n\n            // Apply the sign\n            offsetMinutes = 0 + (sign == '-'? -1 * offsetMinutes : offsetMinutes);\n\n            // Apply offset and local timezone\n            d.setMinutes(d.getMinutes() - offsetMinutes - d.getTimezoneOffset())\n        }\n        else\n            if(prop.indexOf(\"Z\", prop.length - 1) !== -1) {\n                d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate(), d.getHours(), d.getMinutes(), d.getSeconds(), d.getMilliseconds()));\n            }\n\n        // d is now a local time equivalent to the supplied time\n        return d;\n    }\n\n    function checkFromXmlDateTimePaths(value, childName, fullPath) {\n        if(config.datetimeAccessFormPaths.length > 0) {\n            var path = fullPath.split(\"\\.#\")[0];\n            var idx = 0;\n            for(; idx < config.datetimeAccessFormPaths.length; idx++) {\n                var dtPath = config.datetimeAccessFormPaths[idx];\n                if( typeof dtPath === \"string\" ) {\n                    if(dtPath == path)\n                        break;\n                }\n                else\n                if( dtPath instanceof RegExp) {\n                    if(dtPath.test(path))\n                        break;\n                }\n                else\n                if( typeof dtPath === \"function\") {\n                    if(dtPath(obj, childName, path))\n                        break;\n                }\n            }\n            if(idx!=config.datetimeAccessFormPaths.length) {\n                return fromXmlDateTime(value);\n            }\n            else\n                return value;\n        }\n        else\n            return value;\n    }\n\n    function parseDOMChildren( node, path ) {\n        if(node.nodeType == DOMNodeTypes.DOCUMENT_NODE) {\n            var result = new Object;\n            var nodeChildren = node.childNodes;\n            // Alternative for firstElementChild which is not supported in some environments\n            for(var cidx=0; cidx <nodeChildren.length; cidx++) {\n                var child = nodeChildren.item(cidx);\n                if(child.nodeType == DOMNodeTypes.ELEMENT_NODE) {\n                    var childName = getNodeLocalName(child);\n                    result[childName] = parseDOMChildren(child, childName);\n                }\n            }\n            return result;\n        }\n        else\n        if(node.nodeType == DOMNodeTypes.ELEMENT_NODE) {\n            var result = new Object;\n            result.__cnt=0;\n\n            var nodeChildren = node.childNodes;\n\n            // Children nodes\n            for(var cidx=0; cidx <nodeChildren.length; cidx++) {\n                var child = nodeChildren.item(cidx); // nodeChildren[cidx];\n                var childName = getNodeLocalName(child);\n\n                if(child.nodeType!= DOMNodeTypes.COMMENT_NODE) {\n                    result.__cnt++;\n                    if(result[childName] == null) {\n                        result[childName] = parseDOMChildren(child, path+\".\"+childName);\n                        toArrayAccessForm(result, childName, path+\".\"+childName);\n                    }\n                    else {\n                        if(result[childName] != null) {\n                            if( !(result[childName] instanceof Array)) {\n                                result[childName] = [result[childName]];\n                                toArrayAccessForm(result, childName, path+\".\"+childName);\n                            }\n                        }\n                        (result[childName])[result[childName].length] = parseDOMChildren(child, path+\".\"+childName);\n                    }\n                }\n            }\n\n            // Attributes\n            for(var aidx=0; aidx <node.attributes.length; aidx++) {\n                var attr = node.attributes.item(aidx); // [aidx];\n                result.__cnt++;\n                result[config.attributePrefix+attr.name]=attr.value;\n            }\n\n            // Node namespace prefix\n            var nodePrefix = getNodePrefix(node);\n            if(nodePrefix!=null && nodePrefix!=\"\") {\n                result.__cnt++;\n                result.__prefix=nodePrefix;\n            }\n\n            if(result[\"#text\"]!=null) {\n                result.__text = result[\"#text\"];\n                if(result.__text instanceof Array) {\n                    result.__text = result.__text.join(\"\\n\");\n                }\n                if(config.escapeMode)\n                    result.__text = unescapeXmlChars(result.__text);\n                if(config.stripWhitespaces)\n                    result.__text = result.__text.trim();\n                delete result[\"#text\"];\n                if(config.arrayAccessForm==\"property\")\n                    delete result[\"#text_asArray\"];\n                result.__text = checkFromXmlDateTimePaths(result.__text, childName, path+\".\"+childName);\n            }\n            if(result[\"#cdata-section\"]!=null) {\n                result.__cdata = result[\"#cdata-section\"];\n                delete result[\"#cdata-section\"];\n                if(config.arrayAccessForm==\"property\")\n                    delete result[\"#cdata-section_asArray\"];\n            }\n\n            if( result.__cnt == 1 && result.__text!=null  ) {\n                result = result.__text;\n            }\n            else\n            if( result.__cnt == 0 && config.emptyNodeForm==\"text\" ) {\n                result = '';\n            }\n            else\n            if ( result.__cnt > 1 && result.__text!=null && config.skipEmptyTextNodesForObj) {\n                if( (config.stripWhitespaces && result.__text==\"\") || (result.__text.trim()==\"\")) {\n                    delete result.__text;\n                }\n            }\n            delete result.__cnt;\n\n            if( config.enableToStringFunc && (result.__text!=null || result.__cdata!=null )) {\n                result.toString = function() {\n                    return (this.__text!=null? this.__text:'')+( this.__cdata!=null ? this.__cdata:'');\n                };\n            }\n\n            return result;\n        }\n        else\n        if(node.nodeType == DOMNodeTypes.TEXT_NODE || node.nodeType == DOMNodeTypes.CDATA_SECTION_NODE) {\n            return node.nodeValue;\n        }\n    }\n\n    function startTag(jsonObj, element, attrList, closed) {\n        var resultStr = \"<\"+ ( (jsonObj!=null && jsonObj.__prefix!=null)? (jsonObj.__prefix+\":\"):\"\") + element;\n        if(attrList!=null) {\n            for(var aidx = 0; aidx < attrList.length; aidx++) {\n                var attrName = attrList[aidx];\n                var attrVal = jsonObj[attrName];\n                if(config.escapeMode)\n                    attrVal=escapeXmlChars(attrVal);\n                resultStr+=\" \"+attrName.substr(config.attributePrefix.length)+\"='\"+attrVal+\"'\";\n            }\n        }\n        if(!closed)\n            resultStr+=\">\";\n        else\n            resultStr+=\"/>\";\n        return resultStr;\n    }\n\n    function endTag(jsonObj,elementName) {\n        return \"</\"+ (jsonObj.__prefix!=null? (jsonObj.__prefix+\":\"):\"\")+elementName+\">\";\n    }\n\n    function endsWith(str, suffix) {\n        return str.indexOf(suffix, str.length - suffix.length) !== -1;\n    }\n\n    function jsonXmlSpecialElem ( jsonObj, jsonObjField ) {\n        if((config.arrayAccessForm==\"property\" && endsWith(jsonObjField.toString(),(\"_asArray\")))\n                || jsonObjField.toString().indexOf(config.attributePrefix)==0\n                || jsonObjField.toString().indexOf(\"__\")==0\n                || (jsonObj[jsonObjField] instanceof Function) )\n            return true;\n        else\n            return false;\n    }\n\n    function jsonXmlElemCount ( jsonObj ) {\n        var elementsCnt = 0;\n        if(jsonObj instanceof Object ) {\n            for( var it in jsonObj  ) {\n                if(jsonXmlSpecialElem ( jsonObj, it) )\n                    continue;\n                elementsCnt++;\n            }\n        }\n        return elementsCnt;\n    }\n\n    function parseJSONAttributes ( jsonObj ) {\n        var attrList = [];\n        if(jsonObj instanceof Object ) {\n            for( var ait in jsonObj  ) {\n                if(ait.toString().indexOf(\"__\")== -1 && ait.toString().indexOf(config.attributePrefix)==0) {\n                    attrList.push(ait);\n                }\n            }\n        }\n        return attrList;\n    }\n\n    function parseJSONTextAttrs ( jsonTxtObj ) {\n        var result =\"\";\n\n        if(jsonTxtObj.__cdata!=null) {\n            result+=\"<![CDATA[\"+jsonTxtObj.__cdata+\"]]>\";\n        }\n\n        if(jsonTxtObj.__text!=null) {\n            if(config.escapeMode)\n                result+=escapeXmlChars(jsonTxtObj.__text);\n            else\n                result+=jsonTxtObj.__text;\n        }\n        return result;\n    }\n\n    function parseJSONTextObject ( jsonTxtObj ) {\n        var result =\"\";\n\n        if( jsonTxtObj instanceof Object ) {\n            result+=parseJSONTextAttrs ( jsonTxtObj );\n        }\n        else\n            if(jsonTxtObj!=null) {\n                if(config.escapeMode)\n                    result+=escapeXmlChars(jsonTxtObj);\n                else\n                    result+=jsonTxtObj;\n            }\n\n        return result;\n    }\n\n    function parseJSONArray ( jsonArrRoot, jsonArrObj, attrList ) {\n        var result = \"\";\n        if(jsonArrRoot.length == 0) {\n            result+=startTag(jsonArrRoot, jsonArrObj, attrList, true);\n        }\n        else {\n            for(var arIdx = 0; arIdx < jsonArrRoot.length; arIdx++) {\n                result+=startTag(jsonArrRoot[arIdx], jsonArrObj, parseJSONAttributes(jsonArrRoot[arIdx]), false);\n                result+=parseJSONObject(jsonArrRoot[arIdx]);\n                result+=endTag(jsonArrRoot[arIdx],jsonArrObj);\n            }\n        }\n        return result;\n    }\n\n    function parseJSONObject ( jsonObj ) {\n        var result = \"\";\n\n        var elementsCnt = jsonXmlElemCount ( jsonObj );\n\n        if(elementsCnt > 0) {\n            for( var it in jsonObj ) {\n\n                if(jsonXmlSpecialElem ( jsonObj, it) )\n                    continue;\n\n                var subObj = jsonObj[it];\n\n                var attrList = parseJSONAttributes( subObj )\n\n                if(subObj == null || subObj == undefined) {\n                    result+=startTag(subObj, it, attrList, true);\n                }\n                else\n                if(subObj instanceof Object) {\n\n                    if(subObj instanceof Array) {\n                        result+=parseJSONArray( subObj, it, attrList );\n                    }\n                    else if(subObj instanceof Date) {\n                        result+=startTag(subObj, it, attrList, false);\n                        result+=subObj.toISOString();\n                        result+=endTag(subObj,it);\n                    }\n                    else {\n                        var subObjElementsCnt = jsonXmlElemCount ( subObj );\n                        if(subObjElementsCnt > 0 || subObj.__text!=null || subObj.__cdata!=null) {\n                            result+=startTag(subObj, it, attrList, false);\n                            result+=parseJSONObject(subObj);\n                            result+=endTag(subObj,it);\n                        }\n                        else {\n                            result+=startTag(subObj, it, attrList, true);\n                        }\n                    }\n                }\n                else {\n                    result+=startTag(subObj, it, attrList, false);\n                    result+=parseJSONTextObject(subObj);\n                    result+=endTag(subObj,it);\n                }\n            }\n        }\n        result+=parseJSONTextObject(jsonObj);\n\n        return result;\n    }\n\n    this.parseXmlString = function(xmlDocStr) {\n        var isIEParser = window.ActiveXObject || \"ActiveXObject\" in window;\n        if (xmlDocStr === undefined) {\n            return null;\n        }\n        var xmlDoc;\n        if (window.DOMParser) {\n            var parser=new window.DOMParser();\n            var parsererrorNS = null;\n            // IE9+ now is here\n            if(!isIEParser) {\n                try {\n                    parsererrorNS = parser.parseFromString(\"INVALID\", \"text/xml\").childNodes[0].namespaceURI;\n                }\n                catch(err) {\n                    parsererrorNS = null;\n                }\n            }\n            try {\n                xmlDoc = parser.parseFromString( xmlDocStr, \"text/xml\" );\n                if( parsererrorNS!= null && xmlDoc.getElementsByTagNameNS(parsererrorNS, \"parsererror\").length > 0) {\n                    //throw new Error('Error parsing XML: '+xmlDocStr);\n                    xmlDoc = null;\n                }\n            }\n            catch(err) {\n                xmlDoc = null;\n            }\n        }\n        else {\n            // IE :(\n            if(xmlDocStr.indexOf(\"<?\")==0) {\n                xmlDocStr = xmlDocStr.substr( xmlDocStr.indexOf(\"?>\") + 2 );\n            }\n            xmlDoc=new ActiveXObject(\"Microsoft.XMLDOM\");\n            xmlDoc.async=\"false\";\n            xmlDoc.loadXML(xmlDocStr);\n        }\n        return xmlDoc;\n    };\n\n    this.asArray = function(prop) {\n        if(prop instanceof Array)\n            return prop;\n        else\n            return [prop];\n    };\n\n    this.toXmlDateTime = function(dt) {\n        if(dt instanceof Date)\n            return dt.toISOString();\n        else\n        if(typeof(dt) === 'number' )\n            return new Date(dt).toISOString();\n        else\n            return null;\n    };\n\n    this.asDateTime = function(prop) {\n        if(typeof(prop) == \"string\") {\n            return fromXmlDateTime(prop);\n        }\n        else\n            return prop;\n    };\n\n    this.xml2json = function (xmlDoc) {\n        return parseDOMChildren ( xmlDoc );\n    };\n\n    this.xml_str2json = function (xmlDocStr) {\n        var xmlDoc = this.parseXmlString(xmlDocStr);\n        if(xmlDoc!=null)\n            return this.xml2json(xmlDoc);\n        else\n            return null;\n    };\n\n    this.json2xml_str = function (jsonObj) {\n        return parseJSONObject ( jsonObj );\n    };\n\n    this.json2xml = function (jsonObj) {\n        var xmlDocStr = this.json2xml_str (jsonObj);\n        return this.parseXmlString(xmlDocStr);\n    };\n\n    this.getVersion = function () {\n        return VERSION;\n    };\n\n}\n\nmodule.exports = X2JS;\n","var config =  {\n    vehicleZIndex: 10,\n    stopZIndex: 5\n};\nmodule.exports = config;\n","var $ = require('jquery');\nvar ko = require('knockout');\nvar Rappid = require('./rappid');\n\nvar rappid = window.rappid = new Rappid();\nwindow.ko = ko;\n\n$(document).ready(function() {\n\n    console.log(\">>>>>>>>>> HERE\");\n    rappid.adsfasdfqweradsf() + 4;\n    console.log(\">>>>>>>>>> HERE AGAIN\");\n\n    ko.applyBindings(rappid, document.getElementById('lerappid'));\n    rappid.start().catch(function(e) {\n        console.error(e);\n        if (e === 'The CapMetro API is unavailable') {\n            rappid.rustle();\n        }\n    });\n});\n","var ko = require('knockout');\nvar L = require('leaflet');\nvar when = require('when');\nvar NProgress = require('NProgress');\nvar LocateControl = require('./LocateControl');\nvar RoutesCollection = require('./models/RoutesCollection');\nvar Vehicles = require('./models/Vehicles');\nvar Shape = require('./models/Shape');\nvar StopCollection = require('./models/StopCollection');\n\n\nfunction Rappid() {\n    // leaflet\n    this.map = null;\n    this.routeLayer = null;\n    this.latlng = null;\n\n    // data\n    this.vehicles = null;\n    this.shape = null;\n\n    // viewmodels\n    this.availableRoutes = ko.observableArray();\n    this.route = ko.observable();\n    this.stops = ko.observableArray();\n\n    // options\n    this.includeList = ko.observable(true);\n    this.includeMap = ko.observable(true);\n    this.includeToggleBtn = ko.computed(function() {\n        return !this.includeList() || !this.includeMap();\n    }.bind(this));\n}\n\nRappid.prototype = {\n    start: function() {\n        var deferred = when.defer();\n\n        this.resize();\n        this.setupMap();\n\n        RoutesCollection.fetch().then(\n            function(routes) {\n                this.availableRoutes(routes);\n\n                var cachedRoute = JSON.parse(localStorage.getItem('rappid:route')),\n                    defaultRoute = this.availableRoutes()[0];\n\n                if (cachedRoute) {\n                    defaultRoute = this.availableRoutes().filter(function(r) { return cachedRoute.id === r.id && cachedRoute.direction === r.direction; })[0];\n                }\n\n                this.route(defaultRoute);\n                this.setupRoute().then(null, console.error);\n\n                deferred.resolve();\n            }.bind(this),\n            deferred.reject\n        );\n\n        NProgress.configure({ showSpinner: false });\n\n        return deferred.promise;\n    },\n    refresh: function() {\n        NProgress.start();\n\n        var deferred = when.defer(),\n            vehiclesPromise = this.vehicles.fetch(),\n            stopPromises = this.stops().map(function(stop) { return stop.refresh(); }),\n            promises;\n\n        vehiclesPromise.then(this.vehicles.draw.bind(this.vehicles, this.routeLayer));\n\n        promises = [vehiclesPromise];\n        promises = promises.concat(stopPromises);\n\n        when.all(promises).done(\n            function() {\n                NProgress.done();\n                setTimeout(this.refresh.bind(this), 15 * 1000);\n                deferred.resolve(true);\n            }.bind(this),\n            function(e) {\n                console.error(e);\n                NProgress.done();\n                if (e === 'The CapMetro API is unavailable') {\n                    this.rustle();\n                }\n                deferred.resolve(false);\n            }.bind(this)\n        );\n\n        // always resolves to true (success) or false (error)\n        // doesn't not reject because we don't want an error to propogate from here since it is self scheduling\n        return deferred.promise;\n    },\n    setupMap: function() {\n        var tileLayer,\n            zoomCtrl,\n            locateCtrl;\n\n        this.map = L.map('map', {zoomControl: false,});\n        this.map.setView([30.267153, -97.743061], 12);\n\n        tileLayer = L.tileLayer('https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png', {\n            maxZoom: 18,\n            attribution: '<a href=\"http://openstreetmap.org\">OpenStreetMap</a> | <a href=\"http://mapbox.com\">Mapbox</a>',\n            id: 'drmaples.ipbindf8'\n        });\n\n        zoomCtrl = new L.Control.Zoom({position: 'bottomright'});\n\n        locateCtrl = new LocateControl({\n            position: 'bottomright',\n            zoomLevel: 16,\n        });\n\n        tileLayer.addTo(this.map);\n        zoomCtrl.addTo(this.map);\n        locateCtrl.addTo(this.map);\n\n        this.map.on('locationfound', function(e) {\n            if (!this.latlng) {\n                StopCollection.closest(this.stops(), e.latlng);\n            }\n            this.latlng = e.latlng;\n        }.bind(this));\n    },\n    selectRoute: function() {\n        this.setupRoute().done(null, console.error);\n    },\n    setupRoute: function() {\n        var deferred = when.defer(),\n            route = this.route().id,\n            direction = this.route().direction,\n            promises,\n            shapePromise,\n            vehiclesPromise,\n            stopsPromise;\n\n        this.track();\n\n        console.log('Setup route', this.route());\n        localStorage.setItem('rappid:route', ko.toJSON(this.route()));\n\n        if (this.routeLayer) {\n            this.map.removeLayer(this.routeLayer);\n        }\n\n        this.routeLayer = L.layerGroup();\n        this.routeLayer.addTo(this.map);\n\n        this.vehicles = new Vehicles(route, direction);\n        this.shape = new Shape(route, direction);\n\n        shapePromise = this.shape.fetch();\n        shapePromise.then(this.shape.draw.bind(this.shape, this.routeLayer));\n\n        vehiclesPromise = this.vehicles.fetch();\n        vehiclesPromise.then(this.vehicles.draw.bind(this.vehicles, this.routeLayer));\n\n        stopsPromise = StopCollection.fetch(route, direction);\n        stopsPromise.then(\n            function(stops) {\n                StopCollection.draw(stops, this.routeLayer);\n                this.stops(stops);\n\n                if (this.latlng) {\n                    StopCollection.closest(stops, this.latlng);\n                }\n            }.bind(this)\n        );\n\n        promises = [shapePromise, vehiclesPromise, stopsPromise];\n\n        when.all(promises).done(\n            function() {\n                setTimeout(this.refresh.bind(this), 15 * 1000);\n                deferred.resolve();\n            }.bind(this),\n            function(e) {\n                console.error(e);\n                NProgress.done();\n                if (e === 'The CapMetro API is unavailable') {\n                    this.rustle();\n                }\n                deferred.resolve(false);\n            }.bind(this)\n        );\n\n        return deferred.promise;\n    },\n    resize: function(e) {\n        if (window.screen.width <= 1024) {\n            this.includeMap(true);\n            this.includeList(false);\n        }\n        else {\n            this.includeMap(true);\n            this.includeList(true);\n        }\n    },\n    toggleMap: function() {\n        this.includeList(!this.includeList());\n        this.includeMap(!this.includeMap());\n        this.map.invalidateSize();\n        this.map.closePopup();\n        document.body.scrollTop = document.documentElement.scrollTop = 0;\n    },\n    track: function() {\n        var routeDirection = this.route().id + '-' + this.route().direction;\n        window.ga('send', {\n            'dimension1': routeDirection,\n            'hitType': 'screen',\n            'screenName': routeDirection\n        });\n    },\n    rustle: function() {\n        window.alert('CapMetro is experiencing some system issues.');\n        setTimeout(function() {\n            window.alert('There is no need to be upset.');\n            setTimeout(function() {\n                window.location.href = \"https://www.youtube.com/watch?v=ygr5AHufBN4\";\n            }, 5000);\n        }, 2000);\n    }\n};\n\nmodule.exports = Rappid;\n","var utils = {\n    // 550 uses 1 for NB, 801 uses 0 ...thats just how capmetro rolls\n    formatDirection: function(route, direction) {\n        route = parseInt(route);\n        if (direction === 0) {\n            if (route === 801) {\n                return 'North';\n            }\n            if (route === 550) {\n                return 'South';\n            }\n            return 'South';\n        }\n        if (direction === 1) {\n            if (route === 801) {\n                return 'South';\n            }\n            if (route === 550) {\n                return 'North';\n            }\n        }\n        if (direction === 'S') {\n            return 'South';\n        }\n        if (direction === 'N') {\n            return 'North';\n        }\n    },\n    getDirectionID: function(route, direction) {\n        route = parseInt(route);\n        direction = direction.toLowerCase().replace('/', '');\n\n        if (direction === 'north' || direction === 'n') {\n            if (route === 801) {\n                return 0;\n            }\n            if (route === 550) {\n                return 1;\n            }\n        }\n        if (direction === 'south' || direction === 's') {\n            if (route === 801) {\n                return 1;\n            }\n            if (route === 550) {\n                return 0;\n            }\n        }\n\n        return 0;\n    }\n};\n\nmodule.exports = utils;\n","var $ = require('jquery');\nvar when = require('when');\n\nvar RoutesCollection = {\n    fetch: function() {\n        var deferred = when.defer();\n\n        $.ajax({\n            url: 'data/routes.json'\n        }).done(\n            function(data) {\n                var routes = data.map(function(row) {\n                    return row;\n                });\n\n                deferred.resolve(routes);\n            }.bind(this)\n        ).fail(\n            function(xhr, status, err) {\n                console.error(err);\n                deferred.reject(err);\n            }\n        );\n\n        return deferred.promise;\n    }\n};\n\nmodule.exports = RoutesCollection;\n","var $ = require('jquery');\nvar leaflet = require('leaflet');\nvar when = require('when');\nvar config = require('../config');\n\nfunction Shape(route, direction) {\n    this.route = route;\n    this.direction = direction;\n    this._shape = [];\n}\n\nShape.prototype = {\n    fetch: function() {\n        var deferred = when.defer();\n\n        $.ajax({\n            url: 'data/shapes_' + this.route + '_' + this.direction + '.json'\n        }).done(\n            function(data) {\n                this._shape = data.map(function(el) {\n                    return new L.LatLng(el.shape_pt_lat, el.shape_pt_lon);\n                });\n                deferred.resolve();\n            }.bind(this)\n        ).fail(\n            function(xhr, status, err) {\n                console.error(err);\n                deferred.reject(err);\n            }\n        );\n\n        return deferred.promise;\n    },\n    draw: function(layer) {\n        var color ='rgb(199,16,22)',\n            line = new L.Polyline(this._shape, {\n                color: color,\n                stroke: true,\n                weight: 5,\n                opacity: 0.9,\n                smoothFactor: 1\n            });\n        line.addTo(layer);\n        line.bringToBack();  // https://github.com/Leaflet/Leaflet/issues/185\n    }\n};\n\nmodule.exports = Shape;\n","var ko = require('knockout');\nvar when = require('when');\nvar leaflet = require('leaflet');\nvar TripCollection = require('./TripCollection');\nvar fs = require('fs');\nvar config = require('../config');\n\nvar stopPopupHTML = fs.readFileSync(__dirname + '/../templates/stop-popup.html', 'utf8');\n// var stopPopupHTML = \"\";\n\nfunction Stop(data) {\n    var stop_name = data.stop_name.replace('(SB)', '').replace('(NB)', '');\n    this.name = ko.observable(stop_name);\n    this.direction = ko.observable(parseInt(data.direction_id));\n    this.route = ko.observable(parseInt(data.route_id));\n    this.code = ko.observable(data.stop_code);\n    this.desc = ko.observable(data.stop_desc);\n    this.id = ko.observable(data.stop_id);\n    this.lat = ko.observable(data.stop_lat);\n    this.lon = ko.observable(data.stop_lon);\n    this.timezone = ko.observable(data.stop_timezone);\n    this.url = ko.observable(data.url);\n    this.errorMsg = ko.observable();\n\n    this.trips = ko.observableArray();\n\n    this.closest = ko.observable(false);\n    this.cssId = ko.observable('stop-' + data.stop_id);\n\n    this.showTrips = ko.observable(false);\n    this.loadedTrips = ko.observable(false);\n    this.loading = ko.observable(false);\n    this.showProgress = ko.computed(function() {\n        // don't show after the first load\n        return this.loading() && !this.loadedTrips();\n    }.bind(this));\n\n    this.color = 'rgb(199,16,22)';\n\n    this.marker = leaflet.circleMarker([this.lat(), this.lon()], {\n            color: 'white',\n            opacity: 1,\n            weight: 3,\n            fillColor: this.color,\n            fill: true,\n            fillOpacity: 1,\n            radius: 12,\n            zIndexOffset: config.stopZIndex\n        });\n\n    this.marker.bindPopup(this.popupContent());\n\n    this.marker.addEventListener('click', function(e) {\n        if (!this.loadedTrips()) {\n            this.loadTrips().then(null, console.error);\n        }\n    }.bind(this));\n}\n\nStop.prototype = {\n    toggleTrips: function() {\n        this.showTrips(!this.showTrips());\n\n        if (this.showTrips()) {\n            this.marker.openPopup();\n        }\n        else {\n            this.marker.closePopup();\n        }\n\n        if (!this.loadedTrips()) {\n            this.loadTrips().then(\n                null,  // FIXME: Should make the map fit the popup\n                function(e) { console.error(e); }\n            );\n        }\n    },\n    loadTrips: function() {\n        var deferred = when.defer();\n\n        this.showTrips(true);\n        this.loading(true);\n\n        TripCollection.fetch(this.route(), this.direction(), this.id()).then(\n            function(trips) {\n                this.loadedTrips(true);\n                this.loading(false);\n                this.trips(trips);\n                this.errorMsg(null);\n                deferred.resolve();\n            }.bind(this),\n            function(e) {\n                this.loadedTrips(true);\n                this.loading(false);\n                this.errorMsg(e);\n                deferred.reject(e);\n            }.bind(this)\n        );\n\n        return deferred.promise;\n    },\n    refresh: function() {\n        if (this.showTrips()) {\n            return this.loadTrips();\n        }\n    },\n    popupContent: function() {\n        var div = document.createElement('div');\n        div.innerHTML = stopPopupHTML;\n        ko.applyBindings(this, div);\n        return div;\n    }\n};\n\nmodule.exports = Stop;\n","var $ = require('jquery');\nvar L = require('leaflet');\nvar when = require('when');\nvar geolib = require('geolib');\nvar config = require('../config');\nvar Stop = require('./Stop');\n\nvar StopCollection = {\n    fetch: function(route, direction) {\n        var deferred = when.defer();\n\n        $.ajax({\n            url: 'data/stops_' + route + '_' + direction + '.json'\n        }).done(\n            function(data) {\n                var stops = data.map(function(stopData) {\n                    return new Stop(stopData);\n                });\n\n                deferred.resolve(stops);\n            }\n        ).fail(\n            function(a, b, err) {\n                console.error(err);\n                deferred.reject(err);\n            }\n        );\n\n        return deferred.promise;\n    },\n    draw: function(stops, layer) {\n        stops.forEach(function(stop) {\n            stop.marker.addTo(layer);\n        });\n    },\n    closest: function(stops, latlng) {\n        if (!stops.length) return;\n\n        var points = stops.map(function(s) { return { latitude: s.lat(), longitude: s.lon()}; }),\n            _latlng = {latitude: latlng.lat, longitude: latlng.lng },\n            nearestPoint,\n            stop;\n\n        nearestPoint = geolib.findNearest(_latlng, points, 0, 1);\n        stop = stops[parseInt(nearestPoint.key)];\n\n        stop.closest(true);\n        document.body.scrollTop = document.getElementById(stop.cssId()).offsetTop;  // mobile\n        document.getElementById('list').scrollTop = document.getElementById(stop.cssId()).offsetTop;  // desktop\n        stop.toggleTrips();\n\n        return stop;\n    }\n};\n\nmodule.exports = StopCollection;\n","var ko = require('knockout');\nvar moment = require('moment');\n\nfunction Trip(data) {\n    this.tripTime = ko.observable(data.Triptime);\n    this.id = ko.observable(data.Tripid);\n    this.skedTripID = ko.observable(data.Skedtripid);\n    this.block = ko.observable(data.Block);\n    this.exception = ko.observable(data.Exception);\n\n    this.moment = ko.computed(function() { return moment(this.tripTime(), 'hh:mm A'); }.bind(this));\n    this.prettyTime = ko.computed(function() { return this.moment().fromNow(); }.bind(this));\n    this.old = ko.computed(function() { return ! this.moment().isAfter(); }.bind(this));\n}\n\nmodule.exports = Trip;\n","var $ = require('jquery');\nvar when = require('when');\nvar X2JS = require('../X2JS');\nvar utils = require('../utils');\nvar Trip = require('./Trip');\n\nvar x2js = new X2JS({});\n\nvar TripCollection = {\n    fetch: function(route, direction, stop) {\n        var deferred = when.defer(),\n            url = 'http://query.yahooapis.com/v1/public/yql',\n            cap_url = 'http://www.capmetro.org/planner/s_service.asp?output=xml&opt=2&tool=SI&route=' + route + '&stopid=' + stop;\n\n        $.ajax({\n            url: url,\n            data: {\n                q: 'select * from xml where url=\"' + cap_url + '\"',\n                format: 'xml'\n            }\n        }).done(\n            function(data) {\n                var xml = x2js.xml2json(data),\n                    Envelope = xml.query.results.Envelope,\n                    Fault,\n                    Service,\n                    Tripinfo,\n                    trips;\n\n                if (!Envelope) {\n                    console.log(xml);\n                    deferred.reject('The CapMetro API is unavailable');\n                    return;\n                }\n\n                Fault = xml.query.results.Envelope.Body.Fault;\n\n                if (Fault) {\n                    console.error(Fault);\n                    deferred.reject(new Error(Fault.faultstring));\n                    return;\n                }\n\n                Service = xml.query.results.Envelope.Body.SchedulenearbyResponse.Atstop.Service;\n                if (Array.isArray(Service)) {\n                    // Filter out the wrong direction\n                    // But don't filter out the wrong direction if only one service is returned: this happens at the last stop in a route\n                    Service = Service.filter(function(s) {\n                        // `Direction` in the xml is N or S, not 0 or 1. convert it to something sane\n                        return utils.getDirectionID(s.Route, s.Direction) === direction;\n                    })[0];\n                }\n\n\n                Tripinfo = Service.Tripinfo;\n                if (!Array.isArray(Tripinfo)) {\n                    Tripinfo = [Tripinfo];\n                }\n\n                trips = Tripinfo.map(function(tripData) { return new Trip(tripData); });\n\n                // show only the most recent old trip\n                for (var i = 0; i < trips.length; i++) {\n                    if (! trips[i].old()) {\n                        if (i > 0) {\n                            trips = trips.slice(i-1);\n                        }\n                        break;\n                    }\n                }\n\n                deferred.resolve(trips);\n            }.bind(this))\n        .fail(\n            function(xhr, status, err) {\n                console.error('Fetch arrivals', err);\n                deferred.reject();\n            }\n        );\n\n        return deferred.promise;\n    }\n};\n\nmodule.exports = TripCollection;\n","var $ = require('jquery');\nvar L = require('leaflet');\nvar when = require('when');\nvar _ = require('underscore');\nvar X2JS = require('../X2JS');\nvar utils = require('../utils');\nvar config = require('../config');\n\nvar x2js = new X2JS({});\n\nfunction Vehicles(route, direction) {\n    this.route = route;\n    this.direction = direction;\n\n    this._vehicles = [];\n    this._markers = {};\n}\n\nVehicles.prototype = {\n    fetch: function() {\n        var deferred = when.defer();\n\n        $.ajax({\n            url: 'http://query.yahooapis.com/v1/public/yql',\n            data:{\n                q: 'select * from xml where url=\"http://www.capmetro.org/planner/s_buslocation.asp?route=*\"',\n                format: 'xml'\n            }\n        }).done(function(data) {\n            var xml = x2js.xml2json(data),\n                Envelope =  xml.query.results.Envelope,\n                BuslocationResponse;\n\n            if (!Envelope) {\n                console.log(xml);\n                deferred.reject('The CapMetro API is unavailable');\n                return;\n            }\n\n            BuslocationResponse = Envelope.Body.BuslocationResponse;\n\n            if (!BuslocationResponse.Vehicles) {\n                deferred.reject(new Error('Zero active vehicles'));\n                return;\n            }\n\n            this._vehicles = BuslocationResponse.Vehicles.Vehicle;\n\n            if (! Array.isArray(this._vehicles)) {  // not sure if this happens, but just in case\n                this._vehicles = [this._vehicles];\n            }\n\n            this._vehicles.forEach(function(vehicle) {\n                var Position = vehicle.Positions.Position,\n                    posStr = Array.isArray(Position) ? Position[0] : Position;\n                vehicle.lat = posStr.split(',')[0];\n                vehicle.lng = posStr.split(',')[1];\n            });\n\n            deferred.resolve();\n        }.bind(this)).fail(function(xhr, status, err) {\n            deferred.reject(err);\n        });\n\n        return deferred.promise;\n    },\n    draw: function(layer) {\n        var route = this.route,\n            direction = this.direction,\n            matchingVehicles = _.filter(this._vehicles, function(v) {\n                var _route = parseInt(v.Route),\n                    // `Direction` in the xml is N or S, not 0 or 1. convert it to something sane\n                    _dir = utils.getDirectionID(v.Route, v.Direction);\n\n                return route === _route && direction === _dir;\n            }),\n            vehicleIDs = matchingVehicles.map(function(v) { return v.Vehicleid; }),\n            deletedVehicleIDs = _.filter(Object.keys(this._markers), function(vehicleID) {\n                return !_.find(vehicleIDs, function(vID) { return vID === vehicleID; });\n            });\n\n        console.log('Vehicles', matchingVehicles.length, 'Deleted', deletedVehicleIDs.length);\n\n        deletedVehicleIDs.forEach(function(vID) {\n            layer.removeLayer(this._markers[vID]);\n            delete this._markers[vID];\n        }.bind(this));\n\n        matchingVehicles.forEach(function(vehicle) {\n            var marker = this._markers[vehicle.Vehicleid],\n                popupContent = this.popupContent(vehicle),\n                fillColor = vehicle.Inservice === 'Y' ? 'rgb(34,189,252)' : 'rgb(188,188,188)';\n\n            if (marker) {\n                var markerLatLng = marker.getLatLng(),\n                    start = [markerLatLng.lat, markerLatLng.lng],\n                    stop = [parseFloat(vehicle.lat), parseFloat(vehicle.lng)],\n                    steps = 200,\n                    delta = [stop[0] - start[0], stop[1] - start[1]];\n\n                marker._popup.setContent(popupContent);\n                marker.setStyle({fillColor: fillColor});\n\n                if (!_.isEqual(start, stop)) {\n\n                    if (document.visibilityState === 'visible') {\n                        this.animateMarker(marker, 0, steps, start, delta);\n                    } else {\n                        marker.setLatLng(stop);\n                    }\n                }\n\n                return;\n            }\n\n            marker = L.circleMarker([vehicle.lat, vehicle.lng], {\n                color: '#fff',\n                weight: 3,\n                radius: 15,\n                opacity: 1,\n                fillOpacity: '0.9',\n                fillColor: fillColor,\n                zIndexOffset: config.vehicleZIndex\n            });\n\n            marker.bindPopup(popupContent);\n            marker.addTo(layer);\n\n            this._markers[vehicle.Vehicleid] = marker;\n        }.bind(this));\n    },\n    popupContent: function(vehicle) {\n        // FIXME: Bind this with ko like Stop\n        var vehicleId = '<span class=\"id\">Vehicle ' + vehicle.Vehicleid + '</span>',\n            inner = [\n                'Updated at ' + vehicle.Updatetime,\n                'Moving ' + utils.formatDirection(vehicle.Route, vehicle.Direction) + ' at ' + vehicle.Speed + 'mph',\n                'Reliable? ' + vehicle.Reliable,\n                'Stopped? ' + vehicle.Stopped,\n                'Off Route? ' + vehicle.Offroute,\n                'In Service? ' + vehicle.Inservice,\n            ].join('<br />');\n        return '<div class=\"vehicle\">' + vehicleId + inner + '</div>';\n    },\n    easeInOutCubic: function(t, b, c, d) {\n        if ((t/=d/2) < 1) return c/2*t*t*t + b;\n        return c/2*((t-=2)*t*t + 2) + b;\n    },\n    animateMarker: function(marker, i, steps, startLatLng, deltaLatLng) {\n        var x = this.easeInOutCubic(i, startLatLng[0], deltaLatLng[0], steps),\n            y = this.easeInOutCubic(i, startLatLng[1], deltaLatLng[1], steps);\n        marker.setLatLng([x, y]);\n        if (i < steps) {\n            setTimeout(this.animateMarker.bind(this, marker, i+1, steps, startLatLng, deltaLatLng), 10);\n        }\n    }\n};\n\nmodule.exports = Vehicles;\n"],"sourceRoot":"/source/"}